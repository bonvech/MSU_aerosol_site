{% extends "base.html" %}
{% block title %}{{ device }}{% endblock %}
{% block content %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/device/device.css') }}">
  <script type="text/javascript" src="{{ url_for('static', filename='js/device/handlers.js') }}"></script>
  <div class="content">
    <div class="mx-auto head">
      <h1>Данные с прибора {{ device }}</h1>
    </div>
    <h3 class="text">{{ device.name }}{% if device.serial_number %}, {{ device.serial_number }} {% endif %}</h3>
    <h5 class="text">Состоит в комплексе "{{ complex }}"</h5>
    <h5 class="text up"><a href="{{ url_for('device_archive', device_id=device.id) }}">Перейти в архив</a></h5>
    {% if error %}
      <div class="alert alert-danger message" role="alert">
        {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float: right"></button>
      </div>
    {% endif %}
    {% if message %}
      <div class="alert alert-success message" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float: right"></button>
      </div>
    {% endif %}
    <form method="POST" name="datetime_picker" action="{{ url_for('device_download', device_id=device.id) }}">
      <div class="row calendar_row">
        <div class="col calendars">
          <label for="datetime_picker_start" class="control-label">Начало</label>
          <input
                  id="datetime_picker_start"
                  name="datetime_picker_start"
                  class="form-control"
                  type="datetime-local"
                  min={{ min_date }}
                  max={{ max_date }}
                  value={{ min_date }}
                  step="any"
          >
        </div>
        <div class="arrow">
          &rarr;
        </div>
        <div class="col calendars">
          <label for="datetime_picker_end" class="control-label">Конец</label>
          <input
                  id="datetime_picker_end"
                  name="datetime_picker_end"
                  class="form-control"
                  type="datetime-local"
                  min={{ min_date }}
                  max={{ max_date }}
                  value={{ max_date }}
                  step="any"
          >
        </div>
        <div class="col download">
          {% if user and user.is_authenticated %}
            <button type="submit" id="download" class="btn btn-outline-dark my-4">Скачать</button>
          {% endif %}
        </div>
      </div>
    </form>
    <div class="fluid-container button_row_container">
      <div class="row">
        <div class="col-2">
          <button onclick="updateGraph()" class="btn btn-dark">Подтвердить</button>
        </div>
        {% if user.is_authenticated and user.role.can_upload_data %}
            <div class="col-3">
            <form method="POST" name="file_sender" enctype="multipart/form-data" action="{{ url_for('device_upload', device_id=device.id) }}">
              <div class="fluid-container">
                <div class="row">
                  <div class="col-7 send_button">
                    <button type="submit" class="btn btn-dark commit_button">Отправить</button>
                  </div>
                  <div class="form-file col-4 mt-1">
                    <input type="file" class="form-file-input" id="customFile" name="file">
                  </div>
                </div>
              </div>
            </form>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="graph_container" id="graphDiv">
    {% include "includes/devices/full/graph_" ~ device.full_name ~ ".html"  %}
  </div>
{% endblock %}
